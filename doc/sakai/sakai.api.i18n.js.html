<!doctype html><html><head><title>Doc</title><body><dl><dd><a href="#a0">define(</a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a1">changeToJSON </a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a2">init </a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a3">finishI18N </a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a4">translateJqueryPlugins </a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a5">translateDirectory </a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a6">doI18N </a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a7">loadLanguageBundles </a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a8">General </a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a9">process </a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a10">getValueForKey</a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a11">UnicodeExpression</a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a12">processUTF16ToText</a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a13">getEditorLanguage</a></dd><dd>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#a14">getUserLocale</a></dd></dl><pre id="a0">define(</pre><p><b>class</b> i18n  <br/><b>description</b> &lt;p&gt;Internationalisation related functions for general page content, widget content and UI elements.&lt;/p&gt; &lt;p&gt;This should only hold functions which are used across multiple pages, and does not constitute functionality related to a single area/page.&lt;/p&gt;  <br/><b>namespace</b> Internationalisation </p><br/><pre id="a1">changeToJSON : function(input) {</pre><p>This changes properties file into a json object </p><br/><pre id="a2">init : function(meData) {</pre><p>&lt;p&gt;Main i18n process&lt;/p&gt; &lt;p&gt;This function will be executed once the entire DOM has been loaded. The function will take the HTML that's inside the body of the page, and load the default and user specific language bundle. We then look for i18n keys inside the HTML, and replace with the values from the language bundles. We always first check whether the key is available in the user specific bundle and only if that one doesn't exist, we will take the value out of the default bundle.&lt;/p&gt;  <br/><b>param {Object}</b> meData the data from sakai.api.User.data.me </p><br/><pre id="a3">var finishI18N = function() {</pre><p>Once all of the i18n strings have been replaced, we will finish the i18n step. The content of the body tag is hidden by default, in order not to show the non-translated string before they are translated. When i18n has finished, we can show the body again. We then tell the container that pre-loading of the page has finished and that widgets are now ready to be loaded. This will mostly mean that now the general page/container code will be executed. Finally, we will look for the definition of widgets inside the HTML code, which should look like this: - Single instance: &lt;div id='widget_WIDGETNAME' class='widget_inline'&gt;&lt;/div&gt; - Multiple instance support: &lt;div id='widget_WIDGETNAME_UID_PLACEMENT' class='widget_inline'&gt;&lt;/div&gt; and load them into the document </p><br/><pre id="a4">var translateJqueryPlugins = function() {</pre><p>Function that will internationalize the different jquery plugins we use. For example, we want to make sure that the previous and next buttons in the pager plugin are properly using the current user's locale settings </p><br/><pre id="a5">var translateDirectory = function(directory) {</pre><p>Translate all of the elements inside of the directory into the current's language </p><br/><pre id="a6">var doI18N = function() {</pre><p>This will give the body's HTML string, the local bundle (if present) and the default bundle to the general i18n function. This will come back with an HTML string where all of the i18n strings will be replaced. We then change the HTML of the body tag to this new HTML string. <br/><b>param {Object}</b> localjson JSON object where the keys are the keys we expect in the HTML and the values are the translated strings <br/><b>param {Object}</b> defaultjson JSON object where the keys are the keys we expect in the HTML and the values are the translated strings in the default language </p><br/><pre id="a7">var loadLanguageBundles = function() {</pre><p>This will load the default language bundle and will store it in a global variable. This default bundle will be saved in a file called bundle/default.properties. This function will load the general language bundle specific to the language chosen by the user and will store it in a global variable. This language will either be the prefered user language or the prefered server language. The language will be available in the me feed and we'll use the global sakai.api.User.data.me object to extract it from. If there is no prefered langauge, we'll use the default bundle to translate everything. </p><br/><pre id="a8">General : {</pre><p><b>class</b> i18nGeneral  <br/><b>description</b> Internationalisation related functions for general page content and UI elements  <br/><b>namespace</b> General internationalisation functions </p><br/><pre id="a9">process : function(toprocess, widget) {</pre><p>General process functions that will replace all the messages in a string with their corresponding translation. <br/><b>example</b> sakai.api.i18n.General.process( '&lt;h1&gt;__MSG__CHANGE_LAYOUT__&lt;/h1&gt', {'__MSG__CHANGE_LAYOUT__' : 'verander layout'}, {'__MSG__CHANGE_LAYOUT__' : 'change layout'} ); <br/><b>param {String}</b> toprocess HTML string in which we want to replace messages. Messages have the following format: __MSG__KEY__ in the default language <br/><b>param {String}</b> widget optional widget name. This will cause the widget language bundles to be checked for a translation first <br/><b>return {String}</b> A processed string where all the messages are replaced with values from the language bundles </p><br/><pre id="a10">getValueForKey: function(key, widgetname) {</pre><p>Get the internationalised value for a specific key. We expose this function so you can do internationalisation within JavaScript. If the key isn't found in a translation bundle, the key will be returned unmodified  <br/><b>example</b> sakai.api.i18n.getValueForKey('CHANGE_LAYOUT', ['widgetid']); <br/><b>param {String}</b> key The key that will be used to get the translation <br/><b>param {String}</b> optional widget name. This will cause the widget language bundles to be checked for a translation first <br/><b>return {String}</b> The translated value for the provided key </p><br/><pre id="a11">UnicodeExpression: new RegExp('[\\][u][A-F0-9]{4}', 'g'),</pre><p>Utility regular expression that is used to find escaped unicode characters in translation string </p><br/><pre id="a12">processUTF16ToText: function(translation) {</pre><p>Utility function that will take a translation string and replace escaped unicode characters with the actual unicode character <br/><b>param {String}</b> translation   Translation key that we want to scan for escaped unicode <br/><b>return {String}</b> Translation key where all escaped unicode characters have been replaced by the actual unicode character </p><br/><pre id="a13">getEditorLanguage: function() {</pre><p>Get the language for the editor for the current user If the editor language doesn't exist, we default to English <br/><b>return {String}</b> The language for the current user (e.g. 'nl') </p><br/><pre id="a14">getUserLocale: function() {</pre><p>Function that will return the current user's locale Example: en_GB </p><br/></body></html>